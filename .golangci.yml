# .golangci.yml
version: "2"

# Global run settings for performance and CI integration
run:
  # Enable concurrency for faster runs. Set to the number of CPU cores or adjust based on CI limits.
  concurrency: 4 
  
  # Set a generous timeout for CI to avoid failures on large codebases.
  timeout: 5m 

  # Setting exit-code to 1 ensures CI pipelines fail immediately on linter errors.
  issues-exit-code: 1 
  
  # Use default skips to ignore common noisy directories (vendor, testdata, etc.)
  skip-dirs-use-default: true
  
  # Also lint Go test files (*_test.go)
  tests: true 

  # The Go version to use. Keeping it empty uses the version from go.mod (recommended).
  go: "" 

  # Skip files generated by tools (like protobuf, mock generators)
  skip-files:
    - ".*\\.pb\\.go$"
    - "mock_.*\\.go$"
    - ".*\\.gen\\.go$"

# Configure which linters to run
linters:
  # Disabling all first gives you full control over what is enabled.
  # If you prefer to start with a standard set, change this to `standard`.
  disable-all: true
  enable:
    # ----------------------------------------------------------------------
    # 1. Essential, High-Value, Low-False-Positive Linters (Always Include)
    # ----------------------------------------------------------------------
    - govet         # Reports suspicious constructs, part of standard Go toolchain.
    - staticcheck   # Go vet on steroids: comprehensive static analysis.
    - errcheck      # Checks for unchecked errors.
    - unused        # Checks for unused constants, variables, functions, and types.
    - ineffassign   # Detects when assignments to existing variables are not used.

    # ----------------------------------------------------------------------
    # 2. Security Linter
    # ----------------------------------------------------------------------
    - gosec         # Inspects source code for security problems.

    # ----------------------------------------------------------------------
    # 3. Code Quality & Bug Prevention (Recommended)
    # ----------------------------------------------------------------------
    - bodyclose     # Checks if HTTP response bodies are closed successfully.
    - contextcheck  # Checks for missing context.Context usage in function parameters.
    - copyloopvar   # Detects places where loop variables are copied (essential for Go 1.22+ migration).
    - nilerr        # Finds code that returns nil even if it checks that the error is not nil.
    - sqlclosecheck # Checks that sql.Rows, sql.Stmt, etc., are closed.
    - rowserrcheck  # Checks whether rows.Err of sql.Rows is checked successfully.

    # ----------------------------------------------------------------------
    # 4. Opinionated Style & Complexity (Tune to your team's preference)
    # ----------------------------------------------------------------------
    - gocritic      # Provides diagnostics for bugs, performance, and style issues.
    - revive        # Drop-in replacement for golint, configurable for style.
    - gocyclo       # Computes and checks cyclomatic complexity.
    - lll           # Reports long lines (helpful for consistent readability).
    - nestif        # Reports deeply nested if statements.
    - nakedret      # Warns against naked returns in long functions.
    - prealloc      # Checks for inefficient slice preallocation.

# Configuration for specific linters
linters-settings:
  # Staticcheck is highly configurable, good to enable all checks
  staticcheck:
    checks: ["all", "-SA5011"] # SA5011 is a known false positive check
  
  errcheck:
    # Report errors when returning an interface value containing a nil concrete value.
    check-type-assertions: true
    # Report errors when ignoring errors with blank identifier `_`.
    check-blank: true
  
  # Configure import grouping/ordering
  gci:
    # Style: godoc, goimport, or custom
    sections:
      - standard
      - default
      - prefix(github.com/your-org/your-repo) # Use your project's root module
  
  # Set a reasonable limit for complexity
  gocyclo:
    min-complexity: 15 # Functions with complexity >= 15 will be reported

  # Configure maximum line length
  lll:
    line-length: 120 # Adjust this based on your team's screen/preference
    
  # Configure function length for naked returns
  nakedret:
    max-func-lines: 20 # Warn if a naked return is used in a function over 20 lines

  # Configure revived linter to match common style rules
  revive:
    rules:
      - name: "exported"
        severity: "warning"
        disabled: false
        arguments: 
          # Exclude test files from requiring exported functions
          - checkEmbedded: true
          - checkPrivateReceivers: true
      - name: "time-naming"
        severity: "warning"
        disabled: false
      - name: "context-as-first-parameter"
        severity: "error"
        disabled: false

# Fine-grained control over issue reporting
issues:
  # Exclude some linters for test files where complexity/style rules are often relaxed
  exclude-rules:
    - path: _test\.go
      linters:
        - gocyclo
        - dupl
        - funlen
        - unparam
    
    # Exclude warnings on specific file/pattern
    # - path: pkg/some-library/some-file.go
    #   text: "magic number"
    
  # Do not skip generated files by default (unless explicitly skipped in `run` section)
  exclude-use-default: false
  
  # Sort results by file and line number for deterministic output
  sort-results: true

# Formatters section for auto-fixing issues
formatters:
  # Runs 'goimports' internally
  goimports:
    enabled: true
  
  # Runs 'gofmt' internally
  gofmt:
    enabled: true

# Note: Always validate your configuration against the official documentation
# as linters and options change between golangci-lint versions.
